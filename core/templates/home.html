{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="home-container">
    <h2>Latest Updates</h2>

    <!-- Add New Post Form (staff only) -->
    {% if user.is_authenticated and user.is_staff %}
    <div class="add-post-form" style="margin-bottom: 20px; padding:10px; border:1px solid #ccc;">
        <h3>Add New Post</h3>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <p>
                <label for="title">Title:</label><br>
                <input type="text" name="title" id="title" required>
            </p>
            <p>
                <label for="content">Content:</label><br>
                <textarea name="content" id="content" rows="3"></textarea>
            </p>
            <p>
                <label for="post_type">Type:</label><br>
                <select name="post_type" id="post_type" required>
                    <option value="text">Text</option>
                    <option value="photo">Photo</option>
                    <option value="video">Video</option>
                </select>
            </p>
            <p>
                <label for="file">File (optional for photo/video):</label><br>
                <input type="file" name="file" id="file">
            </p>
            <button type="submit">Add Post</button>
        </form>
    </div>
    {% endif %}

    <!-- Posts List -->
    <div class="posts-container">
        {% for post in posts %}
        <div class="post-card" style="border:1px solid #ddd; padding:10px; margin-bottom:10px;">
            <h3>{{ post.title }}</h3>
            <p>{{ post.content|linebreaks }}</p>
            
            {% if post.post_type == "photo" and post.file %}
                <img src="{{ post.file.url }}" alt="{{ post.title }}" style="max-width:100%;">
            {% elif post.post_type == "video" and post.file %}
                <video controls style="max-width:100%;">
                    <source src="{{ post.file.url }}">
                </video>
            {% endif %}

            <!-- Edit/Delete (staff only) -->
            {% if user.is_authenticated and user.is_staff %}
            <div class="post-actions" style="margin-top:10px;">
                <a href="{% url 'edit_post' post.id %}">‚úè Edit</a> |
                <form method="post" action="{% url 'delete_post' post.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" onclick="return confirm('Are you sure you want to delete this post?');">üóë Delete</button>
                </form>
            </div>
            {% endif %}
        </div>
        {% empty %}
        <p>No posts available.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
